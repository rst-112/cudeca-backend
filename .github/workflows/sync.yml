name: Sync to Personal Deployment Repos (main & dev)

on:
  push:
    branches: [main, dev]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Push to personal repo (rst-112)
        env:
          PAT: ${{ secrets.CUDECA_Sync_Token_2025 }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions@users.noreply.github.com"

          REPO_NAME=$(basename "$GITHUB_REPOSITORY")
          git remote add deploy https://rst-112:${PAT}@github.com/rst-112/${REPO_NAME}.git

          CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
          echo "Sincronizando rama ${CURRENT_BRANCH} con rst-112/${REPO_NAME}..."
          git push deploy ${CURRENT_BRANCH}:${CURRENT_BRANCH} --force

      - name: Confirm sync success
        run: echo "CÃ³digo sincronizado correctamente"
