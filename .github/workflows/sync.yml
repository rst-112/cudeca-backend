name: ğŸ”„ Sync cudeca-org â†’ rst-112 (main & dev)

on:
  push:
    branches:
      - main
      - dev
  workflow_dispatch:  # Permite lanzarlo manualmente desde GitHub Actions

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: read  # Solo necesita leer el repo origen

    steps:
      # 1ï¸âƒ£ Clonar el repo completo (con historial y todas las ramas)
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # necesario para tener todo el historial

      # 2ï¸âƒ£ Configurar usuario de git para los commits/pushes automÃ¡ticos
      - name: ğŸ§° Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions@users.noreply.github.com"

      # 3ï¸âƒ£ AÃ±adir el remoto de destino (tu repo personal)
      - name: ğŸ”— Add personal remote
        env:
          PAT: ${{ secrets.SYNC_TO_PERSONAL_PAT }}
        run: |
          REPO_NAME=$(basename "$GITHUB_REPOSITORY")
          DEST_REPO="rst-112/${REPO_NAME}"
          echo "â¡ï¸  AÃ±adiendo remoto: https://github.com/${DEST_REPO}.git"
          git remote add personal https://rst-112:${PAT}@github.com/${DEST_REPO}.git
          git remote -v

      # 4ï¸âƒ£ Hacer push forzado de main y dev hacia tu repo personal
      - name: ğŸš€ Push branches to personal repo
        env:
          PAT: ${{ secrets.SYNC_TO_PERSONAL_PAT }}
        run: |
          echo "ğŸ”„ Sincronizando rama main..."
          git push personal main:main --force

          echo "ğŸ”„ Sincronizando rama dev..."
          git push personal dev:dev --force

          echo "âœ… SincronizaciÃ³n completada correctamente con rst-112/cudeca-backend"
